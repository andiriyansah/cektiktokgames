<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Public - Cek Rahasia</title>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700&family=Crimson+Pro:wght@500&display=swap" rel="stylesheet" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: "Crimson Pro", serif; background: url("img/background.jpg") no-repeat center center fixed; background-size: cover; color: #fefce8; height: 100vh; margin:0; display:flex; justify-content:center; align-items:center; flex-direction:column; overflow:hidden;}
    .scene { width: 80%; max-width: 400px; height: 70%; perspective: 1500px; }
    .card { width: 80%; height: 100%; position: relative; transform-style: preserve-3d; transition: transform 1s; }
    .card.flip { transform: rotateY(180deg); }
    .card-side { position:absolute; width:100%; height:100%; backface-visibility:hidden; display:flex; flex-direction:column; justify-content:center; align-items:center; border-radius:1.5rem; background:url("img/card.jpeg") no-repeat center center; background-size:cover; box-shadow:0 0 25px rgba(255,215,128,0.3); padding:2rem; text-align:center; transition: box-shadow 0.8s; }
    .card.glow { box-shadow:0 0 40px rgba(255,215,128,0.6),0 0 80px rgba(252,211,77,0.3); }
    .card-front { transform: rotateY(0deg); }
    .card-back { transform: rotateY(180deg); }
    #nama,#nama-back { font-family:"Cinzel", serif; font-size:2rem; color:#fcd34d; text-shadow:0 0 15px rgba(252,211,77,0.8);}
    #secret,#secret-back { font-size:1.5rem; margin-top:1rem; line-height:1.4; color:#fff; text-shadow:0 0 12px rgba(0,0,0,0.8);}
    .stars { position:absolute; width:2px; height:2px; background:white; border-radius:50%; animation:twinkle 3s infinite ease-in-out; }
    @keyframes twinkle { 0%,100%{opacity:0.2;} 50%{opacity:1;} }
  </style>
</head>
<body>
  <div id="stars-container"></div>
  <div class="scene">
    <div class="card" id="card">
      <div class="card-side card-front">
        <h1 id="nama"></h1>
        <p id="secret"></p>
        <button onclick="initVoice()" id="voiceBtn" class="mt-6 bg-yellow-500 hover:bg-yellow-600 text-black font-bold py-2 px-6 rounded-full shadow-lg">ðŸ”® Aktifkan Suara</button>
      </div>
      <div class="card-side card-back">
        <h1 id="nama-back"></h1>
        <p id="secret-back"></p>
      </div>
    </div>
  </div>

  <audio id="flipSound" src="https://assets.mixkit.co/sfx/preview/mixkit-fast-paper-swoosh-1491.mp3"></audio>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-app.js";
    import { getDatabase, ref, onChildAdded, limitToLast, query } from "https://www.gstatic.com/firebasejs/12.1.0/firebase-database.js";

    const firebaseConfig = {
    apiKey: "AIzaSyAnOP9lM2pdsdWlNhPbDDnf5J04AaAOZd8",
    authDomain: "tiktokgames-bb0b8.firebaseapp.com",
    projectId: "tiktokgames-bb0b8",
    storageBucket: "tiktokgames-bb0b8.firebasestorage.app",
    messagingSenderId: "194321657662",
    appId: "1:194321657662:web:9d2053cbc122862784c66f",
    measurementId: "G-MK7KM3GPNH"
  };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    let lastText = "";
    let flipped = false;
    let voiceReady = false;
    let selectedVoice = null;

    function initVoice() {
      voiceReady = true;
      speak("Suara berhasil diaktifkan.");
      document.getElementById("voiceBtn").style.display = "none";
    }

    function speak(text) {
      if (!("speechSynthesis" in window) || !voiceReady) return;
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = "id-ID";
      utterance.pitch = 1;
      utterance.rate = 0.95;
      if (selectedVoice) utterance.voice = selectedVoice;
      window.speechSynthesis.cancel();
      window.speechSynthesis.speak(utterance);
    }

    function loadVoices() {
      const voices = window.speechSynthesis.getVoices();
      selectedVoice = voices.find(v => v.lang === "id-ID" && v.name.toLowerCase().includes("google")) || null;
    }
    window.speechSynthesis.onvoiceschanged = loadVoices;
    loadVoices();

    const rahasiaRef = query(ref(db,"rahasia"), limitToLast(1));
    const card = document.getElementById("card");
    const flipSound = document.getElementById("flipSound");

    onChildAdded(rahasiaRef, (snapshot) => {
      const data = snapshot.val();
      const combinedText = `${data.nama}, ${data.secret}`;

      if(combinedText !== lastText){
        document.getElementById("nama-back").innerText = data.nama;
        document.getElementById("secret-back").innerText = data.secret;

        card.classList.toggle("flip");
        card.classList.add("glow");
        setTimeout(() => card.classList.remove("glow"),1500);

        flipSound.currentTime=0;
        flipSound.play();

        lastText = combinedText;
        flipped = !flipped;
        speak(combinedText);
      }
    });

    // bintang animasi
    const starContainer = document.getElementById("stars-container");
    for(let i=0;i<60;i++){
      const star=document.createElement("div");
      star.className="stars";
      star.style.top=Math.random()*100+"vh";
      star.style.left=Math.random()*100+"vw";
      star.style.animationDuration=(2+Math.random()*3)+"s";
      starContainer.appendChild(star);
    }
  </script>
</body>
</html>
